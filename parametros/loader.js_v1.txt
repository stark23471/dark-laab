// loader.js - AssetLoader (versão final sugerida)
class AssetLoader {
  constructor(onProgress) {
    this.manager = new THREE.LoadingManager();
    this.manager.onProgress = (url, itemsLoaded, itemsTotal) => {
      if (onProgress) onProgress({url, itemsLoaded, itemsTotal});
    };
    this.textureLoader = new THREE.TextureLoader(this.manager);
  }

  async loadScene1Textures() {
    const base = 'assets/floresta/';
    const list = {
      asfalto_color: base + 'asfalto/asfalto.color.png',
      trilha_color: base + 'trilha/trilha_color.jpg',
      solo_terra_01: base + 'solo_terra_01/solo_terra_01.color.jpg',
      solo_terra_02: base + 'solo_terra_02/solo_terra_02.color.jpg',
      porta: 'assets/porta.png',
      arvore: 'assets/arvore.png',
      lady: 'assets/ghosts/lady.png',
      child: 'assets/ghosts/child.png'
    };

    const textures = {};
    const keys = Object.keys(list);
    await Promise.all(keys.map(async key => {
      try {
        textures[key] = await this._loadTexture(list[key]);
      } catch (e) {
        console.warn('Falha ao carregar textura', list[key], e);
        textures[key] = null;
      }
    }));
    return textures;
  }

  _loadTexture(url) {
    return new Promise((resolve, reject) => {
      this.textureLoader.load(url, tex => resolve(tex), undefined, err => reject(err));
    });
  }
}

// export como global (se estiver usando scripts clássicos)
window.AssetLoader = AssetLoader;
